<!DOCTYPE html>
<meta charset="utf-8">
<head>
    <title>Lab 3 Map</title>
    <meta charset="UTF-8" />
    <script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>
    <style type="text/css">
        .map {
            fill: green;
        }
    </style>
</head>

<body>
    <script type="text/javascript">
        var agDataLink = "https://raw.githubusercontent.com/oliviagrace12/datavis/5ab15bbe0573a463ba2967fe91984cd05cbdaa3b/lab_3/assignment/lab_3_combined/geovis/us-ag-productivity.csv";
        var usStatesDataLink = "https://raw.githubusercontent.com/oliviagrace12/datavis/main/lab_3/assignment/lab_3_combined/geovis/us-states.json";

        var w = 500;
        var h = 300;

        var projection = d3.geoAlbersUsa().translate([w / 2, h / 2]).scale([500]);
        var path = d3.geoPath().projection(projection);

        var color = d3.scaleQuantize().range(["rgb(237,248,233)", "rgb(186,228,179)",
            "rgb(116,196,118)", "rgb(49,163,84)", "rgb(0,109,44)"]);

        var svg = d3.select("body")
            .append("svg")
            .attr("width", w).
            attr("height", h);

        var findJsonState = function (dataState, json) {
            for (var j = 0; j < json.features.length; j++) {
                var jsonState = json.features[j].properties.name;
                if (dataState == jsonState) {
                    return json.features[j];
                }
            }
        };

        var data = d3.csv(agDataLink, function (data) {

            color.domain([
                d3.min(data, (d) => { return d.value }),
                d3.max(data, (d) => { return d.value })
            ])

            d3.json(usStatesDataLink,
                (json) => {
                    for (var i = 0; i < data.length; i++) {
                        var dataState = data[i].state;
                        var dataValue = parseFloat(data[i].value);
                        var jsonState = findJsonState(dataState, json);

                        jsonState.properties.value = dataValue;
                    }

                    svg.selectAll("path")
                        .data(json.features)
                        .enter()
                        .append("path")
                        .attr("d", path)
                        .style("fill", (d) => {
                            var value = d.properties.value;
                            if (value) {
                                return color(value);
                            } else {
                                return "#ccc";
                            }
                        });
                });

        });</script>
</body>
